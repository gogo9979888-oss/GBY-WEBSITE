<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù…ÙˆÙ‚Ø¹ Ø¨ÙŠØ¹ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„Ø§Øª</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {font-family:Tahoma;background:#f8faf5;margin:0}
    header {background:linear-gradient(90deg,#d4af37,#b8941f);padding:20px;color:#fff;text-align:center}
    .container {max-width:800px;margin:auto;padding:15px}
    .box {background:#fff;padding:20px;border-radius:10px;box-shadow:0 0 10px #00000015}
    input,textarea {width:100%;padding:10px;margin:8px 0;border-radius:6px;border:1px solid #ccc}
    button {padding:12px;background:#22c55e;color:#fff;border:none;border-radius:6px;width:100%;cursor:pointer}
    button:hover{opacity:0.8}
    .payments{display:flex;gap:10px}
    .pay{flex:1;border:2px solid #ddd;padding:10px;text-align:center;border-radius:6px;cursor:pointer}
    .pay.active{border-color:#d4af37;background:#fff9db}
    .admin-btn{position:fixed;bottom:15px;left:15px;width:45px;height:45px;border-radius:50%;background:#d4af37;color:white;font-size:18px}
    .admin{display:none;position:fixed;top:5%;left:5%;width:90%;height:90%;background:#fff;overflow:auto;padding:20px;border-radius:12px}
    table{width:100%;border-collapse:collapse}
    th,td{border-bottom:1px solid #ddd;padding:8px}
  </style>
</head>

<body>

<header>
  <h2>ğŸ’° Ù…ÙˆÙ‚Ø¹ Ø¨ÙŠØ¹ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„Ø§Øª</h2>
</header>

<div class="container">
  <div class="box">
    <form id="sellForm">

      <input id="name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" required>
      <input id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required>
      <input id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" required>

      <textarea id="emails" placeholder="Ø³Ø·Ø± Ù„ÙƒÙ„ Ø¥ÙŠÙ…ÙŠÙ„"></textarea>
      <div id="count">Ø¹Ø¯Ø¯ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„Ø§Øª: 0</div>

      <div class="payments">
        <div class="pay" data="orange">ğŸŸ  Orange</div>
        <div class="pay" data="binance">ğŸŸ¡ Binance</div>
      </div>

      <input id="orange" placeholder="Ø±Ù‚Ù… Orange Cash" style="display:none">
      <input id="binance" placeholder="Binance ID" style="display:none">

      <button type="submit">Ø¥Ø±Ø³Ø§Ù„</button>

    </form>
  </div>
</div>

<button class="admin-btn" id="adminBtn">ğŸ”’</button>

<div class="admin" id="adminPanel">
  <h3>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h3>
  <button onclick="load()">ØªØ­Ø¯ÙŠØ«</button>
  <button onclick="deleteAll()">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>

  <table>
    <thead>
      <tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù‡Ø§ØªÙ</th><th>Ø¹Ø¯Ø¯</th><th>Ø­Ø°Ù</th></tr>
    </thead>
    <tbody id="table"></tbody>
  </table>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>

const ADMIN_CODE = "19582006"

// âœ… Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ
const SUPABASE_URL = "https://pprysupijoxyingshour.supabase.co"
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBwcnlzdXBpam94eWluZ3Nob3VyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQxNTA4NjUsImV4cCI6MjA3OTcyNjg2NX0.CGMRfI54Nq6I-8CgtlxUJ-KEjDPKg-r-Y9WO37yaBFE"

const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY)

let payMethod = null

// Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹
document.querySelectorAll('.pay').forEach(b=>{
  b.onclick=()=>{
    document.querySelectorAll('.pay').forEach(x=>x.classList.remove('active'))
    b.classList.add('active')
    payMethod=b.dataset.data
    document.getElementById("orange").style.display = payMethod=="orange"?"block":"none"
    document.getElementById("binance").style.display = payMethod=="binance"?"block":"none"
  }
})

// Ø¹Ø¯ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„Ø§Øª
document.getElementById("emails").oninput=function(){
  let n=this.value.trim().split("\n").filter(x=>x).length
  document.getElementById("count").innerText="Ø¹Ø¯Ø¯ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„Ø§Øª: "+n
}

// Ø¥Ø±Ø³Ø§Ù„
document.getElementById("sellForm").onsubmit=async(e)=>{
  e.preventDefault()

  let name=nameEl.value.trim()
  let email=emailEl.value.trim()
  let phone=phoneEl.value.trim()
  let emails=emailsEl.value.trim()
  let count=emails.split("\n").filter(x=>x).length

  let paynum = payMethod=="orange"?orange.value:binance.value

  await supabase.from("GBB").insert([{
    name,email,phone,emails,
    email_count:count,
    payment_method:payMethod,
    payment_number:paynum,
    date_label:new Date().toLocaleString("ar-EG")
  }])

  alert("âœ… ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„")
  location.reload()
}

// Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
adminBtn.onclick=()=>{
  let c=prompt("ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„:")
  if(c===ADMIN_CODE){
    adminPanel.style.display="block"
    load()
  }
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
async function load(){
  let {data}=await supabase.from("GBB").select("*").order("id",{ascending:false})
  let t=""
  data.forEach(r=>{
    t+=`<tr><td>${r.name}</td><td>${r.phone}</td><td>${r.email_count}</td>
    <td><button onclick="del(${r.id})">ğŸ—‘</button></td></tr>`
  })
  table.innerHTML=t
}

// Ø­Ø°Ù Ø³Ø¬Ù„
async function del(id){
  if(confirm("Ø­Ø°ÙØŸ")){
    await supabase.from("GBB").delete().eq("id",id)
    load()
  }
}

// Ø­Ø°Ù Ø§Ù„ÙƒÙ„
async function deleteAll(){
  if(confirm("Ù…Ø³Ø­ Ø§Ù„Ø¬Ù…ÙŠØ¹ØŸ")){
    await supabase.from("GBB").delete().gt("id",0)
    load()
  }
}

// Ø±Ø¨Ø· Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
const nameEl=name
const emailEl=email
const phoneEl=phone
const emailsEl=emails

</script>

</body>
</html>
